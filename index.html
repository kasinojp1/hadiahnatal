<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roda Hadiah — Natal KASINOJP</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(180deg,#071229,#0c1624);
  color:#fff;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
}
h1 {font-size:28px;text-align:center;margin-bottom:20px;background: linear-gradient(90deg,#ffef9f,#d4af37);-webkit-background-clip:text;color:transparent;}
.input-row {
  display:flex; gap:10px; margin-bottom:20px;
}
input[type="text"] {
  padding:12px 16px; border-radius:12px; border:none; font-weight:600; flex:1;
}
button {
  padding:12px 18px; border-radius:12px; border:none; background:#ffef9f; color:#111; font-weight:700; cursor:pointer;
}
button:hover {background:#ffd966;}
button:disabled {opacity:0.6; cursor:not-allowed;}
.wheel-container {position:relative;width:300px;height:300px;margin-bottom:20px;}
.wheel {width:100%;height:100%;border-radius:50%;border:8px solid #ffd966;position:relative;overflow:hidden;transition:transform 5s cubic-bezier(0.25,1,0.5,1);}
.segment {position:absolute;width:50%;height:50%;top:50%;left:50%;transform-origin:0% 0%;border-top-right-radius:300px;color:#111;display:flex;align-items:flex-end;justify-content:flex-start;padding:10px;font-weight:700;text-shadow:0 2px 4px rgba(0,0,0,0.4);}
.pointer {position:absolute;top:-10px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:20px solid #ffef9f;}
#result {margin-top:20px;font-size:18px;font-weight:700;text-align:center;}
</style>
</head>
<body>

<h1>Roda Hadiah — Natal KASINOJP</h1>

<div class="input-row">
  <input type="text" id="voucherInput" placeholder="Masukkan kode voucher">
  <button id="spinBtn">Putar Roda</button>
</div>

<div class="wheel-container">
  <div class="pointer"></div>
  <div class="wheel" id="wheel"></div>
</div>

<div id="result">Hasil akan muncul di sini</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, get, set, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDlpuf_uIlpmr2ybAqpJ2GTTRW-t86PGf0",
  authDomain: "hadiahnatal-a033b.firebaseapp.com",
  databaseURL: "https://hadiahnatal-a033b-default-rtdb.firebaseio.com",
  projectId: "hadiahnatal-a033b",
  storageBucket: "hadiahnatal-a033b.firebasestorage.app",
  messagingSenderId: "577153304596",
  appId: "1:577153304596:web:5f255e886a379ccb12bf01",
  measurementId: "G-C5Q83YQ6SK"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const wheel = document.getElementById('wheel');
const spinBtn = document.getElementById('spinBtn');
const voucherInput = document.getElementById('voucherInput');
const resultEl = document.getElementById('result');

let prizes = [];
let spinning = false;

// --- Ambil daftar hadiah realtime ---
const prizesRef = ref(db,'gameConfig/prizes');
onValue(prizesRef,snap=>{
  if(snap.exists()){
    prizes = snap.val();
    renderWheel();
  }
});

// --- Buat segmen roda ---
function renderWheel(){
  wheel.innerHTML='';
  const colors = ['#ff6b6b','#ff9f1c','#06d6a0','#1b9aaa','#9d4edd','#ffd166','#f94144'];
  const angle = 360 / prizes.length;
  prizes.forEach((p,i)=>{
    const seg = document.createElement('div');
    seg.className = 'segment';
    seg.textContent = p;
    seg.style.transform = `rotate(${i*angle}deg) skewY(-${90-angle}deg)`;
    seg.style.background = colors[i % colors.length];
    wheel.appendChild(seg);
  });
}

// --- Spin roda setelah cek voucher ---
spinBtn.addEventListener('click', async ()=>{
  const code = voucherInput.value.trim();
  if(!code){alert('Masukkan voucher'); return;}
  if(spinning) return;

  const voucherRef = ref(db,'gameConfig/vouchers/'+code);
  const snap = await get(voucherRef);
  if(!snap.exists()){alert('Voucher tidak valid'); return;}

  spinning = true;
  const winnerIndex = Math.floor(Math.random() * prizes.length);
  const angle = 360 / prizes.length;
  const rotation = 360*5 + winnerIndex*angle + angle/2;

  wheel.style.transition = 'transform 5s cubic-bezier(0.25,1,0.5,1)';
  wheel.style.transform = `rotate(${rotation}deg)`;

  // Setelah selesai animasi, hapus voucher agar tidak bisa dipakai lagi
  setTimeout(async ()=>{
    resultEl.textContent = `Selamat! Kamu mendapatkan: ${prizes[winnerIndex]}`;
    await set(voucherRef, {used:true, won:prizes[winnerIndex]});
    spinning = false;
  },5200);
});
</script>

</body>
</html>
