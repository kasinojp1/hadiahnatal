<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>User - Tebak Kartu</title>
<style>
body{margin:0;font-family:Inter,Poppins,sans-serif;background:#080808;color:#fff;display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px;}
.wrap{width:100%;max-width:920px;background:#111;padding:20px;border-radius:12px;border:1px solid rgba(212,175,55,0.1);}
h1{color:#d4af37;margin:0 0 8px;}
.code-row{display:flex;gap:10px;align-items:center;margin-bottom:18px;}
input{padding:10px;border-radius:8px;border:none;background:#0b0f10;color:#fff;}
.btn{background:#d4af37;color:#111;padding:10px 12px;border-radius:8px;border:none;cursor:pointer;}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;}
.card{height:140px;border-radius:10px;background:#0b0b0b;border:1px solid rgba(212,175,55,0.05);display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;transition:transform .25s;}
.card:hover{transform:translateY(-6px);box-shadow:0 12px 30px rgba(0,0,0,0.4);}
.card.locked{filter:grayscale(.2) blur(.2px);cursor:not-allowed;}
.card.revealed{background:rgba(212,175,55,0.1);}
.card .label{color:#bfc6c9;}
.badge{position:absolute;top:10px;right:10px;background:rgba(0,0,0,0.4);color:#d4af37;padding:4px 6px;border-radius:6px;font-weight:700;}
.result-area{margin-top:16px;}
.small{font-size:13px;color:#bfc6c9;}
</style>
</head>
<body>
<div class="wrap">
<h1>Tebak Kartu</h1>
<div class="code-row">
<input id="codeInput" placeholder="Kode akses..."/>
<button id="verifyBtn" class="btn">Verify</button>
<div class="small" id="status">Status: belum terkoneksi</div>
</div>
<div id="gridWrap" class="grid"></div>
<div class="result-area" id="resultArea"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, get, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const firebaseConfig = {
apiKey: "AIzaSyDlpuf_uIlpmr2ybAqpJ2GTTRW-t86PGf0",
authDomain: "hadiahnatal-a033b.firebaseapp.com",
databaseURL: "https://hadiahnatal-a033b-default-rtdb.firebaseio.com",
projectId: "hadiahnatal-a033b",
storageBucket: "hadiahnatal-a033b.firebasestorage.app",
messagingSenderId: "577153304596",
appId: "1:577153304596:web:5f255e886a379ccb12bf01",
measurementId: "G-C5Q83YQ6SK"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const dbRef = ref(db,"gameConfig/cards");

const gridWrap=document.getElementById('gridWrap');
const verifyBtn=document.getElementById('verifyBtn');
const codeInput=document.getElementById('codeInput');
const status=document.getElementById('status');
const resultArea=document.getElementById('resultArea');

let serverConfig=null;
let unlocked=false;
let revealed=new Set();

function buildGrid(){
  gridWrap.innerHTML='';
  for(let i=0;i<9;i++){
    const c=document.createElement('div');
    c.className='card locked';
    c.dataset.index=i;
    c.innerHTML=`<div class="label">Kartu ${i+1}</div><div class="badge">?</div>`;
    c.addEventListener('click',onCardClick);
    gridWrap.appendChild(c);
  }
}

function setStatus(txt){status.textContent='Status: '+txt;}

async function fetchConfig(){
  setStatus('Memuat konfigurasi...');
  try{
    onValue(dbRef,(snap)=>{
      if(snap.exists()){
        serverConfig = snap.val();
        setStatus('Siap - data tersedia');
        if(!unlocked) buildGrid();
      }else{setStatus('Belum ada konfigurasi');}
    });
  }catch(err){console.error(err);setStatus('Gagal: '+err.message);}
}

function onCardClick(e){
  const el=e.currentTarget;
  const idx=Number(el.dataset.index);
  if(!unlocked || revealed.has(idx)) return;
  const cards = serverConfig?.cards||[];
  const value = cards[idx]||'Kosong';
  el.classList.add('revealed');
  el.querySelector('.label').textContent=value;
  el.querySelector('.badge').textContent=value==='Platinum'?'P':value==='Diamond'?'D':value==='Super Diamond'?'S':'?';
  revealed.add(idx);

  const msg=document.createElement('div');
  msg.className='small';
  msg.textContent=`Kamu membuka Kartu ${idx+1}: ${value}`;
  resultArea.prepend(msg);
}

verifyBtn.addEventListener('click',()=>{
  const code=(codeInput.value||'').trim();
  if(!serverConfig){setStatus('Tidak ada konfigurasi');return;}
  if(code===serverConfig.code){unlocked=true;setStatus('Kode benar');document.querySelectorAll('.card').forEach(c=>c.classList.remove('locked'));}
  else{unlocked=false;setStatus('Kode salah');}
});

buildGrid();
fetchConfig();
</script>
</body>
</html>
